<?php element('header'); ?>
<?php element('nav'); ?>

<?php 

// WEBLOG FOR PURISTS
// VER 0.1

$list = array();
$folder = 'www/weblog';

function updateList() {
	global $list;
	$folder = 'www/weblog';
	$extensions = 'html';
		
		$folder = trim($folder);
	    $folder = ($folder == '') ? './' : $folder;
	 
	    if (!is_dir($folder)){ die('invalid folder given!'); }
	    if ($dir = @opendir($folder)){

	        while($file = readdir($dir)){
	            if (!preg_match('/^\.+$/', $file) and 
	                preg_match('/\.('.$extensions.')$/', $file)){
		                	$ctime = filectime($folder.'/'.$file);
		                	$list[$ctime] = $file;                
	            }            
	        }        	        
	        closedir($dir);    
	        krsort($list);
	    }
}

function renderBlog() {
	global $list;
	
	if(!$_GET['sub']){
		updateList();
	}else{
		$list[] = $_GET['sub'].'.html';
	}
	
	if (count($list)>0) {
		foreach ($list as &$value) {
		    echo('<article>');
			include('www/weblog/'.$value);
			if(!$_GET['sub']){
				echo ('<p><a href="/blog/'.rtrim($value, ".html").'">pre link</a></p>');
			}
			echo ('</article>');
		}	
	}else{
		echo('<p>no posts</p>');
	}
	
}

renderBlog();
?>
<?php element('footer'); ?>